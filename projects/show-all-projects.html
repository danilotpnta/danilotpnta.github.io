<script id='script-part'>
    
    // ------------------------- ON WINDOWS LOAD -------------------------
    window.onload = function(){
      var currentUrl = window.location.href;
      var index_hashtag = currentUrl.lastIndexOf("#");
      var index_slash = currentUrl.lastIndexOf("/");
      // window.alert("index_hashtag: " + index_hashtag + " index_slash: " + index_slash);
      
      var filename1 = currentUrl.substr(index_hashtag);
      var filename2 = currentUrl.substr(index_slash);
      // window.alert("path#: " + filename1 + " path/: " + filename2);

      if (! (index_hashtag === -1) ){
        if (currentUrl.includes("#category=") && !(currentUrl.includes("#category=All")) ){
          displayCategories(true);
        }
      }

      // Defining variables to handle hover and  
      // background when https:....../#category= is reloaded
      var index_equal = currentUrl.lastIndexOf("=");
      var id_name = currentUrl.substr(index_equal);
      
      // Slice symbol "=", Shows only Category
      id_name = id_name.slice(1);
      
      // If contains special chr "%20" then replace it to "\ "
      const substr = "%20";
      if (id_name.includes(substr)){
        id_name = id_name.replace(substr, "\ ");        
      } 

      // Makes remaining CATEGORIES have normal hover
      document.querySelectorAll('.array_categories').forEach(item => {
        item_cleaned = item.textContent.trim();
        if (! (item_cleaned === id_name)){
          // console.log("item_cleaned_cat: " + item_cleaned);
          handle_id(item_cleaned, "grey");
        }
      });

      // Makes remaining TAGS have normal hover
      document.querySelectorAll('.array_tags').forEach(item => {
        item_cleaned = item.textContent.trim();
        if (! (item_cleaned === id_name)){
          // console.log("item_cleaned_tag: " + item_cleaned);
          handle_id(item_cleaned, "grey");
        }
      });

      // Makes focused Category/Tag have green background
      // console.log("id_name: " +id_name);
      handle_id(id_name, "rgba(88, 226, 104, 0.21)")

      var raw_array_categories = [];
      var raw_array_tags = [];
      var array_categories = {};
      var array_tags = {};

      getElements_from_array('.array_categories', raw_array_categories)
      getElements_from_array('.array_tags', raw_array_tags)
      countElements(raw_array_categories, array_categories);
      countElements(raw_array_tags, array_tags);


      // Display the text only if: There is a name for the tag or category
      // AND if that name is part of the array of tags or categories
      if( !(id_name === "")  &&  ( (raw_array_categories.includes(id_name))  || (raw_array_tags.includes(id_name))  )) {

        // Display text if is NOT the id_name is: #category=All
        if( !(id_name === "All")){
          changeText(id_name);
        }
      }

      if (raw_array_categories.includes(id_name)){
        // console.log(`accessing dict category: ${array_categories[id_name]}, with id: ${id_name}`);
        changeGreenNumber(array_categories[id_name], 'categorized:' );
      } else {
        // console.log(`accessing dict tags: ${array_tags[id_name]}, with id: ${id_name}`);
        changeGreenNumber(array_tags[id_name],'tagged:');
      }

    }

    // ------------------------- ON # HASHTAG CHANGE -------------------------
    window.addEventListener('hashchange', function() { 

      var currentUrl = window.location.href;
      console.log("currentUrl: " +currentUrl);

      var index_equal = currentUrl.lastIndexOf("=");
      var id_name = currentUrl.substr(index_equal);
      
      // Slice symbol "=", Shows only Category
      id_name = id_name.slice(1);
      
      // If contains special chr "%20" then replace it to "\ "
      const substr = "%20";
      if (id_name.includes(substr)){
        id_name = id_name.replace(substr, "\ ");        
      } 

      // Makes remaining CATEGORIES have normal hover
      document.querySelectorAll('.array_categories').forEach(item => {
        item_cleaned = item.textContent.trim();
        if (! (item_cleaned === id_name)){
          handle_id(item_cleaned, "grey");
        }
      });

      // Makes remaining TAGS have normal hover
      document.querySelectorAll('.array_tags').forEach(item => {
        item_cleaned = item.textContent.trim();
        if (! (item_cleaned === id_name)){
          handle_id(item_cleaned, "grey");
        }
      });

      // Makes focused Category/Tag have green background
      // console.log("id_name: " +id_name);
      handle_id(id_name, "rgba(88, 226, 104, 0.21)")

      if (currentUrl.includes("#category=") ){
        displayCategories(true);
      }

      if (currentUrl.includes("#category=All")){
        displayCategories(false);
      }  
        

      var raw_array_categories = [];
      var raw_array_tags = [];
      var array_categories = {};
      var array_tags = {};

      getElements_from_array('.array_categories', raw_array_categories)
      getElements_from_array('.array_tags', raw_array_tags)
      countElements(raw_array_categories, array_categories);
      countElements(raw_array_tags, array_tags);


      // Display the text only if: There is a name for the tag or category
      // AND if that name is part of the array of tags or categories
      if( !(id_name === "")  &&  ( (raw_array_categories.includes(id_name))  || (raw_array_tags.includes(id_name))  )) {

        // Display text if is NOT the id_name is: #category=All
        if( !(id_name === "All")){
          changeText(id_name);
        }
      }

      if (raw_array_categories.includes(id_name)){
        // console.log(`accesing dict category: ${array_categories[id_name]}, with id: ${id_name}`);
        changeGreenNumber(array_categories[id_name], 'categorized:' );
      } else {
        // console.log(`accesing dict tags: ${array_tags[id_name]}, with id: ${id_name}`);
        changeGreenNumber(array_tags[id_name],'tagged:');
      }

    });


    // ------------------------- HELPER FUNCTIONS -------------------------
    function handle_id(name, color) {
      var elms = document.getElementsByClassName(name);

      for (var i = 0; i < elms.length; i ++) {
        if (color == "grey"){
          elms[i].classList.remove("hoverMainId")
        } else {
          elms[i].classList.add("hoverMainId")
        }
      }
    }
    
    // Count same elements in array
    function countElements (array_to_be_counted,array_counts){
      array_to_be_counted.forEach(function (x) { array_counts[x] = (array_counts[x] || 0) + 1; });
    }
    
    // Get all the elements store in an array and push it to array name
    function getElements_from_array (class_name, array_name){
        document.querySelectorAll(class_name).forEach(item => {
          item_cleaned = item.textContent.trim();
          array_name.push(item_cleaned);
        });
    }

    // Places the number of CATEGORY or TAG posts counted
    // and changes where is category or tag

    function changeGreenNumber (number, is_cat_or_tag){
      var number_green = document.getElementById("green_number_blog");
      number_green.textContent = number;

      var tag_cat_label = document.getElementById("tagged_categorized_as");
      let text1 = "project";
      let text2 = "projects";

      if (number == 1){
        tag_cat_label.textContent = text1.concat(" ", is_cat_or_tag);
      }
      else{ 
        tag_cat_label.textContent = text2.concat(" ", is_cat_or_tag);
      }
      
    }

    //Places the CATEGORY or TAG name to display
    function changeText(name_tu_put){
      var tag_cat_name = document.getElementById("tag_category_name");
      tag_cat_name.textContent = name_tu_put;  

      var show_info_tag_cat = document.getElementById("show-tag-cat-selected");
      show_info_tag_cat.style.display = "contents"  

    }

    // Hides or Displays the two col grid div
    function displayCategories(boolean) {

      // Displays two col grid
      if (boolean == true){
        var icon_reload = document.getElementById('show-div-two-grid');
        icon_reload.style.display = "grid";

        var icon_reload_padding = document.getElementById('reload-posts-icon-padding');
        icon_reload_padding.style.paddingBottom = "0px";
      }

      // Hides two col grid
      if (boolean == false) {
        var icon_reload = document.getElementById('show-div-two-grid');
        icon_reload.style.display = "none";
      }

    }

</script>